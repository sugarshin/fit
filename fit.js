// Generated by CoffeeScript 1.9.0
(function(root, factory) {
  if (typeof module === 'object' && typeof module.exports === 'object') {
    module.exports = factory(require('jquery'), require('throttle-debounce'));
  } else {
    root.Fit || (root.Fit = factory(root.jQuery));
  }
})(this, function($, td) {
  "use strict";
  var Fit;
  if (td === void 0) {
    td = $;
  }
  return Fit = (function() {
    var _$window;

    _$window = $(window);

    Fit.prototype._defaults = {
      type: 'cover',
      ratio: 0.5625,
      maxHeight: null,
      minHeight: null,
      lineHeight: false,
      delay: 400,
      delayType: 'debounce'
    };

    Fit.prototype._getRandomString = (function() {
      var chars;
      chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz';
      return function(length) {
        var i, randomNumber, string, _i;
        if (length == null) {
          length = 32;
        }
        string = '';
        for (i = _i = 0; 0 <= length ? _i < length : _i > length; i = 0 <= length ? ++_i : --_i) {
          randomNumber = Math.floor(Math.random() * chars.length);
          string += chars.substring(randomNumber, randomNumber + 1);
        }
        return string;
      };
    })();

    Fit.prototype._configure = function(el, opts) {
      this.$el = $(el);
      this.opts = $.extend({}, this._defaults, opts);
      return this._namespace = this._getRandomString();
    };

    function Fit(_at_el, opts) {
      this.el = _at_el;
      this._configure(this.el, opts);
      this.events();
      this.resize();
    }

    Fit.prototype.setWindowSize = function() {
      var windowHeight;
      this._windowWidth = _$window.width();
      windowHeight = _$window.height();
      if (this.opts.maxHeight != null) {
        this._windowHeight = this.opts.maxHeight;
      } else if ((this.opts.minHeight != null) && windowHeight < this.opts.minHeight) {
        this._windowHeight = this.opts.minHeight;
      } else {
        this._windowHeight = windowHeight;
      }
      return this;
    };

    Fit.prototype.getWindowSize = function() {
      return [this._windowWidth, this._windowHeight];
    };

    Fit.prototype._calcCover = function() {
      var displayRatio;
      this.setWindowSize();
      displayRatio = this.getWindowSize()[1] / this.getWindowSize()[0];
      if (this.opts.ratio > displayRatio) {
        this._width = this.getWindowSize()[0];
      } else {
        this._width = this.getWindowSize()[1] / this.opts.ratio;
      }
      this._height = this._width * this.opts.ratio;
      this._marginTop = -(this._height / 2);
      this._marginLeft = -(this._width / 2);
      return this;
    };

    Fit.prototype._calcContain = function() {
      var displayRatio;
      this.setWindowSize();
      displayRatio = this.getWindowSize()[1] / this.getWindowSize()[0];
      if (this.opts.ratio > displayRatio) {
        this._height = this.getWindowSize()[1];
        this._width = this._height / this.opts.ratio;
        this._marginTop = -(this.getWindowSize()[1] / 2);
        this._marginLeft = -(this._width / 2);
      } else {
        this._width = this.getWindowSize()[0];
        this._height = this._width * this.opts.ratio;
        this._marginTop = -(this._height / 2);
        this._marginLeft = -(this.getWindowSize()[0] / 2);
      }
      return this;
    };

    Fit.prototype.resize = function() {
      if (this.opts.type === 'cover') {
        this._calcCover();
      } else if (this.opts.type === 'contain') {
        this._calcContain();
      }
      this.$el.css({
        width: this._width,
        height: this._height,
        marginTop: this._marginTop,
        marginLeft: this._marginLeft
      });
      if (this.opts.lineHeight === true) {
        this.$el.css({
          lineHeight: this._height + "px"
        });
      }
      return this;
    };

    Fit.prototype.events = function() {
      _$window.on("resize.fit:" + this._namespace, td[this.opts.delayType](this.opts.delay, (function(_this) {
        return function() {
          return _this.resize();
        };
      })(this)));
      return this;
    };

    Fit.prototype.unbind = function() {
      _$window.off("resize.fit:" + this._namespace);
      return this;
    };

    return Fit;

  })();
});
